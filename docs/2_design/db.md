# 概要

Database の定義を書く。

## テーブル構成

| テーブル名      | 説明                                             |
| --------------- | ------------------------------------------------ |
| bad_codes       | 悪いコードの情報を格納するテーブル               |
| files           | ファイルの情報を格納するテーブル                 |
| bad_codes_files | 悪いコードとファイルの関連情報を格納するテーブル |
| tags            | 悪いコードのタグ情報を格納するテーブル           |

## DB 詳細

**users テーブル**

| カラム名    | データ型 | NULLABLE | 制限              |
| ----------- | -------- | -------- | ----------------- |
| id          | UUID     | FALSE    |
| username    | TEXT     | FALSE    | 1 < username < 30 |
| avatar_url  | TEXT     | TRUE     |                   |
| email       | TEXT     | FALSE    | 3 < email < 256   |
| description | TEXT     | TRUE     | description < 256 |

**bad_codes テーブル**

| カラム名   | データ型     | 制限                 |
| ---------- | ------------ | -------------------- |
| id         | INT          |                      |
| title      | VARCHAR(255) | 悪いコードのタイトル |
| language   | VARCHAR(255) | 言語                 |
| user_id    | INT          | 登録者 ID            |
| created_at | TIMESTAMP    | 作成日時             |
| updated_at | TIMESTAMP    | 更新日時             |

**files テーブル**

| カラム名   | データ型     | 制限        |
| ---------- | ------------ | ----------- |
| id         | INT          | ファイル ID |
| name       | VARCHAR(255) | ファイル名  |
| created_at | TIMESTAMP    | 作成日時    |
| updated_at | TIMESTAMP    | 更新日時    |

**bad_codes_files テーブル**

| カラム名    | データ型  | 説明          |
| ----------- | --------- | ------------- |
| bad_code_id | INT       | 悪いコード ID |
| file_id     | INT       | ファイル ID   |
| created_at  | TIMESTAMP | 作成日時      |
| updated_at  | TIMESTAMP | 更新日時      |

\*\*tags | 悪いコードのタグ情報を格納するテーブル |

**関係性**

| テーブル名      | 外部キー                    |
| --------------- | --------------------------- |
| bad_codes_files | bad_code_id (bad_codes.id)  |
| bad_codes_files | file_id (files.id)          |
| tags            | bad_codes_id (bad_codes.id) |

**機能要件を満たすための設計**

- **悪いコードの閲覧**
  - bad_codes テーブルから、検索条件に一致するレコードを取得する。
  - 取得したレコードから、タイトル、ファイル名、言語、タグ、コメントなどの情報を表示する。
  - files テーブルから、ファイル名を取得する。
- **悪いコードの登録**
  - 悪いコードのタイトル、ファイル名、言語、タグ、コメントを入力する。
  - bad_codes テーブルに、入力した情報を登録する。
  - files テーブルに、ファイル名を登録する。
  - bad_codes_files テーブルに、悪いコードとファイルの関連情報を登録する。
- **悪いコードの検索**
  - bad_codes テーブルから、検索条件に一致するレコードを取得する。
- **ファイル検索からの悪いコード一覧検索**
  - files テーブルから、検索条件に一致するレコードを取得する。
  - 取得したレコードから、bad_codes テーブルに関連付けられたレコードを取得する。

**その他機能**

- **ログイン機能**
  - users テーブルに、ユーザー ID、メールアドレス、パスワードを登録する。
  - ユーザー ID とパスワードを入力して、ログインする。

この DB 設計では、以下の点が変更されています。

- files テーブルから、言語のカラムを削除しました。
- bad_codes テーブルに、言語のカラムを追加しました。
- tags テーブルから、言語のカラムを削除しました。

この設計では、ファイルの言語はファイル名から推測します。また、悪いコードの言語は、登録時にユーザーが入力します。タグは、悪いコードのタグ検索のために存在するため、言語は不要です。
